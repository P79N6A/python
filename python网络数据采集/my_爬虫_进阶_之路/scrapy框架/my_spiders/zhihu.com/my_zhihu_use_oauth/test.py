# coding:utf-8

'''
@author = super_fazai
@File    : 每日幸运大转盘.py
@Time    : 2017/12/13 10:43
@connect : superonesfazai@gmail.com
'''

import os, base64
from selenium import webdriver
import selenium.webdriver.support.ui as ui
import gc
from scrapy.selector import Selector
import re
from time import sleep

PHANTOMJS_DRIVER_PATH = '/Users/afa/myFiles/tools/phantomjs-2.1.1-macosx/bin/phantomjs'
CHROME_DRIVER_PATH = '/Users/afa/myFiles/tools/chromedriver'

str = '''data:image/png;base64,R0lGODdhlgA8AIcAAP7+/gICAufn5xcXF9jY2CcnJ0dHR8jIyFZWVvLy8oaGhnd3d2dnZ5eXlzY2
Nqenp7e3t6mpqbe3tzs7O8LCwp2dnUBAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAlgA8AEAI/wABCBxI
sKDBgwgTKlzIsKHDhxAjDhRwQAKCAQEyatyYsQCAjyAPABhJsiSABQgYFDiwIAAECQIAyJxJU6YA
AgwGBCjgwEGAnz8HABgqAIEBBQIAKF3KtKnTp1CjSp3qVMECBAUCBCggAIDXrw4cBDBgQMEBAgAA
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
'''


def init_phantomjs():
    """
    初始化带cookie的驱动，之所以用phantomjs是因为其加载速度很快(快过chrome驱动太多)
    """
    '''
    研究发现, 必须以浏览器的形式进行访问才能返回需要的东西
    常规requests模拟请求会被阿里服务器过滤, 并返回请求过于频繁的无用页面
    '''
    print('--->>>初始化phantomjs驱动中<<<---')
    cap = webdriver.DesiredCapabilities.PHANTOMJS
    cap['phantomjs.page.settings.resourceTimeout'] = 1000  # 1秒
    # cap['phantomjs.page.settings.loadImages'] = False
    cap['phantomjs.page.settings.disk-cache'] = True
    # cap['phantomjs.page.settings.userAgent'] = HEADERS[randint(0, 34)]  # 随机一个请求头
    # cap['phantomjs.page.customHeaders.Cookie'] = cookies
    tmp_execute_path = PHANTOMJS_DRIVER_PATH

    driver = webdriver.PhantomJS(executable_path=tmp_execute_path, desired_capabilities=cap)

    wait = ui.WebDriverWait(driver, 20)  # 显示等待n秒, 每过0.5检查一次页面是否加载完毕
    print('------->>>初始化完毕<<<-------')
    return driver

def auto():
    driver = init_phantomjs()
    tmp_url = 'https://www.zhihu.com/account/unhuman?type=unhuman'
    driver.get(tmp_url)
    sleep(3)
    driver.save_screenshot('tmp.png')
    body = driver.page_source
    # img_data = list(Selector(text=body).css('div.Unhuman-inputRow img').extract())
    img_data = driver.find_element_by_id('Unhuman-inputRow')
    print(img_data)
    img_data = re.compile(r'data:image/png;base64,').sub('', img_data)
    print(img_data)
    img_data=base64.b64decode(img_data)
    with open('./data/b.png','wb') as file:
        file.write(img_data)
        file.close()
    try:
        driver.quit()
    except:
        pass
    gc.collect()

auto()